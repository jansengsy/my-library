!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).arcCharts={})}(this,(function(t){"use strict";var e={};function a(t,a){e[a]=t}function r(t){var e=d3.select("#container_".concat(t));e.selectAll(".legend_".concat(t)).remove(),e.selectAll(".chart_svg").remove()}function n(t,e,a,r,n,i,s){var u=e+r.left+r.right-20,d=[],h=0,m=0;i.forEach((function(t,e){var a=10+c(t)+20;t=t.replaceAll(" ","_"),u>h+a?(d[e]={item:t,legendCurrentRow:m,itemWidth:a,legendRowCurrentWidth:h},h+=a):(m+=1,h=0,d[e]={item:t,legendCurrentRow:m,itemWidth:a,legendRowCurrentWidth:h},h=a)}));var p=d3.select("#chart_".concat(n)).append("g").attr("class","legend_".concat(n)).attr("transform","translate(0, ".concat(a+r.top+r.bottom-60,")")).selectAll(".legend-item").data(d).enter().append("g").attr("class","legend-item").attr("transform",(function(t){return"translate(".concat(10+t.legendRowCurrentWidth,", ").concat(15*t.legendCurrentRow,")")})).on("mouseenter",(function(e){return l(t,d3.event,n)})).on("mouseout",(function(e){return o(t,d3.event,n)}));p.append("rect").attr("width",10).attr("height",10).attr("fill",(function(t,e){return"".concat(s[e])})).attr("transform",(function(t,e){"translate(".concat(t.legendRowCurrentWidth,", ").concat(5,")")})),p.append("text").attr("x",15).attr("y",9).style("font-size","14px").style("font-family","Calibri").attr("transform",(function(t,e){"translate(".concat(t.legendRowCurrentWidth,", 0)")})).text((function(t){return t.item.replaceAll("_"," ")}))}function l(t,e,a){if("area"===t)d3.select("#chart_".concat(a)).selectAll(".".concat(e.target.__data__.item)).attr("fill","yellow");else if("snail"===t){var r=e.target.__data__.item.replaceAll(" ","_").replaceAll("/","-").replaceAll(".","");d3.select("#chart_".concat(a)).selectAll(".".concat(r)).attr("stroke-width",4),d3.select("#chart_".concat(a)).selectAll("circle.".concat(r)).attr("r",7)}}function o(t,a,r){if("area"===t){var n=a.target.__data__;d3.select("#chart_".concat(r)).selectAll(".".concat(n.item)).attr("fill","#".concat(e[r].Colours[n.item.replaceAll("_"," ")]))}else if("snail"===t){var l=a.target.__data__.item.replaceAll(" ","_").replaceAll("/","-").replaceAll(".","");d3.select("#chart_".concat(r)).selectAll(".".concat(l)).attr("stroke-width",2),d3.select("#chart_".concat(r)).selectAll("circle.".concat(l)).attr("r",5)}}function c(t){var e=document.createElement("canvas"),a=e.getContext("2d");a.font="".concat("14px"," ").concat("Calibri");var r=a.measureText(t).width;return e.remove(),r}function i(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return s(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}var u,d=["#ff0000","#a04476","#936eb1","#5090cd","#00a489","#ff8000","#28427b"];t.addToGlobalCharts=a,t.area=function(t){var e,l,o,c,i,s,u={top:5,right:15,bottom:45,left:45};s=t.Name.replace("chart_",""),a(t,s);var d=Object.values(t.Colours).map((function(t){return"#"+t}));if(r(s),t.RawValues.Default.length<1)showChartNoData(t);else{var h=t.Labels.Default.map((function(t){return t.replaceAll(" ","_")})),m=t.RawValues.Default,p=h.length,f=[];c=d3.select("#".concat(t.Name)).node().getBoundingClientRect().width-u.left-u.right,i=d3.select("#".concat(t.Name)).node().getBoundingClientRect().height-u.top-u.bottom,25,n("area",c,i,u,s,t.Labels.Default,d),(m=m.flatMap((function(t){var e=t[0];return t.slice(1).map((function(t){return[e,t]}))}))).forEach((function(t,e){t.assetType=h[e%p],t.date=new Date(1e3*t[0]).toLocaleDateString(),t.percentage=e%p>0?Math.abs(t[1]-m[e-1][1]):t[1],t.startingPercentage=e>0?m[e-1][1]:null})),m.forEach((function(t,e){t[0]=1e3*t[0];var a=new Date(t[0]);f.push(a)}));for(var g=d3.select("#".concat(t.Name)).append("g").attr("width","".concat(c+u.left+u.right)).attr("height","".concat(i+u.top+u.bottom)).attr("class","chart_svg").attr("transform","translate(".concat(u.left,", ").concat(u.top,")")),y=d3.scaleTime().domain(d3.extent(f)).range([0,c]),b=d3.scaleLinear().domain([100,0]).nice().range([0,i-u.bottom-25]),C=d3.area().x((function(t){return y(t[0])})).y0((function(t){return t.assetType===h[0]?i-u.bottom-25:b(t.startingPercentage)})).y1((function(t){return b(t[1])})),x=0;x<m.length-p;x++)g.append("path").datum([m[x],m[x+p]]).attr("d",C).attr("id","area").attr("class","area ".concat(h[x%p])).attr("fill","#".concat(t.Colours[h[x%p].replaceAll("_"," ")]));var N=d3.axisBottom(y);N.tickFormat(d3.timeFormat("%b %y")),g.append("g").attr("class","x-axis").style("color","black").style("font-size","10px").attr("transform","translate(0, ".concat(i-u.bottom-25,")")).call(N).selectAll("text").attr("transform","rotate(45)").style("text-anchor","start");var v=d3.axisLeft(b);v.tickFormat(d3.format(".1f")),g.append("g").attr("class","y-axis").style("color","black").style("font-size","10px").call(v),d3.selectAll("#chart_".concat(s)).on("mousemove",(function(t){"area"===d3.event.target.id?function(t){o.style("display","block").attr("x1",d3.pointer(t)[0]).attr("x2",d3.pointer(t)[0]).attr("y1",0+u.top).attr("y2",i-u.bottom+u.top-25),l.style("display","block").attr("y1",d3.pointer(t)[1]).attr("y2",d3.pointer(t)[1]).attr("x1",0+u.left).attr("x2",c+u.left);var a,r,n=t.target.__data__[0];d3.pointer(t)[0]>c/2?(a=d3.pointer(t)[0]-120,r=d3.pointer(t)[1]+u.bottom+15):(a=d3.pointer(t)[0]+u.left-u.right,r=d3.pointer(t)[1]+u.bottom+15);e.style("left",a+"px").style("top",r+"px"),e.style("display","block"),e.style("color","black");var s=["<b>Asset:</b> ".concat(n.assetType.replaceAll("_"," ")),"<b>Percentage:</b> ".concat(Number(n.percentage).toFixed(1),"%"),"<b>Date:</b> ".concat(n.date)];e.html(s.join("<br>"))}(d3.event):"tooltip-line"!==d3.event.target.id&&(e.style("display","none"),e.text(""),l.style("display","none"),o.style("display","none"))})),e=d3.select("#tooltip_".concat(s)),l=d3.select("#chart_".concat(s)).append("line").attr("id","tooltip-line").attr("stroke","red").attr("stroke-width",1).attr("stroke-dasharray","2,2"),o=d3.select("#chart_".concat(s)).append("line").attr("id","tooltip-line").attr("stroke","red").attr("stroke-width",1).attr("stroke-dasharray","2,2")}},t.clearChartDrawArea=r,t.createRealTimeAreaChart=function(t){return"area"},t.createRealTimeDonutChart=function(t){return t.ChartName&&t.ChartTypeString&&t.UID?c3.generate({bindto:"#"+t.UID,data:{xs:{},columns:[],type:t.ChartTypeString,labels:!0,xSort:!1,order:null},interaction:{enabled:!t.SuppressUpdate},point:{show:!0,r:4},zoom:{enabled:!0},axis:null,donut:{width:70,expand:t.SuppressUpdate?0:350},transition:{duration:t.SuppressUpdate?0:250},tooltip:{show:!t.SuppressUpdate,contents:function(e){return createRealtimeToolTip(e,this,t)}}}):null},t.createRealTimeLineChart=function(t){return t.ChartName&&t.ChartTypeString&&t.UID?c3.generate({bindto:"#"+t.UID,data:{xs:{},columns:[],type:t.ChartTypeString,labels:!1,xSort:!1,order:null},interaction:{enabled:!t.SuppressUpdate},point:{show:!1,r:4},zoom:{enabled:!0},axis:t.Axis,transition:{duration:t.SuppressUpdate?0:250},tooltip:{show:!t.SuppressUpdate,contents:function(e){return createRealtimeToolTip(e,this,t)}}}):null},t.createRealTimePieChart=function(t){return t.ChartName&&t.ChartTypeString&&t.UID?c3.generate({bindto:"#"+t.UID,data:{xs:{},columns:[],type:t.ChartTypeString,labels:!0,xSort:!1,order:null},interaction:{enabled:!t.SuppressUpdate},point:{show:!0,r:4},zoom:{enabled:!0},donut:{width:70,expand:t.SuppressUpdate?0:350},transition:{duration:t.SuppressUpdate?0:250},tooltip:{show:!t.SuppressUpdate,contents:function(e){return createRealtimeToolTip(e,this,t)}}}):null},t.createRealTimeScatterChart=function(t){return t.ChartName&&t.ChartTypeString&&t.UID?c3.generate({bindto:"#"+t.UID,data:{xs:{},columns:[],type:t.ChartTypeString,labels:!0,xSort:!1,order:null},interaction:{enabled:!t.SuppressUpdate},point:{show:!0,r:4},zoom:{enabled:!0},axis:t.Axis,transition:{duration:t.SuppressUpdate?0:250},tooltip:{show:!t.SuppressUpdate,contents:function(e){return createRealtimeToolTip(e,this,t)}}}):null},t.createRealTimeSnailChart=function(t){return"snail"},t.drawLegend=n,t.getFromGlobalChartsData=function(t){return e[t]},t.getStringLengthInPixels=c,t.handleLegendIn=l,t.handleLegendOut=o,t.handleSnailLegendIn=function(t,e){var a=t.item.replaceAll(" ","_").replaceAll("/","-").replaceAll(".","");d3.select("#chart_".concat(e)).selectAll(".".concat(a)).attr("stroke-width",4),d3.select("#chart_".concat(e)).selectAll("circle.".concat(a)).attr("r",7)},t.handleSnailLegendOut=function(t,e){var a=t.item.replaceAll(" ","_").replaceAll("/","-").replaceAll(".","");d3.select("#chart_".concat(e)).selectAll(".".concat(a)).attr("stroke-width",2),d3.select("#chart_".concat(e)).selectAll("circle.".concat(a)).attr("r",5)},t.highlightAsset=function(t,e){d3.select("#chart_".concat(e)).selectAll(".".concat(t.item)).attr("fill","yellow")},t.realTimeAreaChartOnResize=function(t){updateRealTimeAreaChart(globalChartData[t.uid.replace("chart_","")])},t.realTimeSnailChartOnResize=function(t){updateRealTimeSnailChart(globalChartData[t.uid.replace("chart_","")])},t.snail=function(t){var e,l,o,c={top:5,right:15,bottom:35,left:45},s=[];if(a(p,e=t.Name.replace("chart_","")),r(e),t.RawValues.Default.length<1)showChartNoData(t);else{var h=t.Labels.Default;s=[];var m=[];l=d3.select("#".concat(t.Name)).node().getBoundingClientRect().width-c.left-c.right,o=d3.select("#".concat(t.Name)).node().getBoundingClientRect().height-c.left-c.right,25,n("snail",l,o,c,e,t.Labels.Default,d),t.RawValues.Default.forEach((function(t){1===t[1]?(m=[t],s.push(m)):m.push(t)})),h.forEach((function(t,e){s[e].forEach((function(t){t[0]=h[e]}))}));var p=s.length,f=[i(s[p-2][0]),i(s[p-1][0])],g=f[0][2],y=f[0][3],b=f[1][2],C=(f[1][3]-y)/(b-g),x=y-C*g,N=0*C+x,v=d3.max(s.flat().map((function(t){return t[t.length-2]}))),_=C*v+x;f[0][2]=0,f[0][3]=N,f[1][2]=v,f[1][3]=_;var A=s.flat().map((function(t){return t[t.length-2]})),w=s.flat().map((function(t){return t[t.length-1]}));w.push(_);var T=d3.select("#".concat(t.Name)).attr("width","".concat(l+c.left+c.right)).attr("height","".concat(o+c.top+c.bottom)).append("g").attr("class","chart_svg").attr("transform","translate(".concat(c.left,", ").concat(c.top,")")),S=d3.scaleLinear().domain([d3.min(A),d3.max(A)]).range([0,l]),R=d3.scaleLinear().domain([d3.min(w),d3.max(w)]).nice().range([o-c.bottom-25,0]),D=d3.axisBottom(S);D.tickFormat(d3.format(".1f")),T.append("g").attr("class","x-axis").style("color","black").style("font-size","10px").attr("transform","translate(0, ".concat(o-25-c.bottom,")")).call(D);var k=d3.axisLeft(R);k.tickFormat(d3.format(".2f")),T.append("g").attr("class","y-axis").style("color","black").style("font-size","10px").call(k),d3.select("g#yAxisG").select("path").remove(),T.selectAll("xGrid").data(S.ticks().slice(0)).join("line").attr("x1",(function(t){return S(t)})).attr("x2",(function(t){return S(t)})).attr("y1",0).attr("y2",o-25-c.bottom).attr("stroke","#e0e0e0").attr("stroke-width",.5),T.selectAll("yGrid").data(R.ticks().slice(0)).join("line").attr("x1",0).attr("x2",l).attr("y1",(function(t){return R(t)})).attr("y2",(function(t){return R(t)})).attr("stroke","#e0e0e0").attr("stroke-width",.5);var L=d3.line().x((function(t){return S(t[2])})).y((function(t){return R(t[3])}));T.append("path").datum(f).attr("d",L).attr("fill","none").attr("stroke","green").attr("stroke-width",2),s.forEach((function(t,e){var a=t[0][0].replaceAll(" ","_").replaceAll("/","-").replaceAll(".","");T.append("path").datum(t).attr("d",L).attr("class","trail").attr("class",a).attr("fill","none").attr("stroke","".concat(d[e])).attr("opacity",1).attr("stroke-width",2),T.append("circle").attr("class","dot").attr("class",a).attr("cx",S(t[0][2])).attr("cy",R(t[0][3])).attr("r",5).attr("fill","".concat(d[e]))})),T.selectAll("circle").on("mouseover",(function(a,r){!function(e,a,r){var n;u=d3.select("#tooltip_".concat(r)),t=s[a][0],n=d3.pointer(e)[0]>l/2?d3.pointer(e)[0]-150:d3.pointer(e)[0]+c.left+c.right;u.style("left",n+"px").style("top",d3.pointer(e)[1]+25+"px"),u.style("display","block"),u.style("color","black");var o=["Portfolio: ".concat(t[0]),"Risk relative to benchmark: ".concat(t[2].toFixed(2)),"Return % per month: ".concat(t[3].toFixed(2),"%")];u.html(o.join("<br>"))}(d3.event,r,e)})).on("mouseout",(function(){return u.style("display","none"),void u.text("")}))}},t.unhighlightAsset=function(t,e){d3.select("#chart_".concat(e)).selectAll(".".concat(t.item)).attr("fill","#".concat(globalChartData[e].Colours[t.item.replaceAll("_"," ")]))},t.updateRealTimeDonutChart=function(t){if(t.Name in realtimecharts){var e=realtimecharts[t.Name].chart,a=realtimecharts[t.Name].suppressupdate,r=[];void 0!==t.Colours&&t.Colours&&$.each(t.Colours,(function(e,a){t.Colours[e]&&(realtimecharts[t.Name].colours[e]="#"+t.Colours[e])}));var n=!1;$.each(t.XValues,(function(e,a){$.each(a,(function(a,l){!n&&$.isNumeric(l)&&parseFloat(l)>0&&(n=!0),r.push([t.Labels[e][a],parseFloat(l)]),realtimecharts[t.Name].labels[t.Labels[e][a]]=t.Labels[e][a]}))})),n?(e.load({columns:r,colors:realtimecharts[t.Name].colours,done:function(){setChartAsLoaded(t.Name)}}),hideChartNoData(realtimecharts[t.Name])):showChartNoData(realtimecharts[t.Name]),hideChartSpinner(realtimecharts[t.Name]),setTimeout((function(){resizeRealTimeChart(realtimecharts[t.Name],!1)}),a?0:350)}},t.updateRealTimeLineChart=function(t){if(t.Name in realtimecharts){var e=realtimecharts[t.Name].chart,a=realtimecharts[t.Name].suppressupdate,r=[],n=0;void 0!==t.Colours&&t.Colours&&$.each(t.Colours,(function(e,a){t.Colours[e]&&(realtimecharts[t.Name].colours[e]="#"+t.Colours[e])}));var l={},o=null,c=null,i="time"==e.internal.config.axis_x_type||"timeseries"==e.internal.config.axis_x_type;$.each(t.XValues,(function(e,a){var n=0,s=[],u=[];s.push(e+"_x"),u.push(e),$.each(a,(function(a,r){if(r.indexOf("-")>=0){var l=Date.parse(r);s.push(l),i&&(l=moment(l),(null==c||l<c)&&(c=l),(null==o||l>o)&&(o=l))}else s.push(parseFloat(r));u.push(t.YValues[e][n]),n++})),r.push(s),r.push(u),l[e]=e+"_x",realtimecharts[t.Name].labels[e]=t.Labels[e]})),e.load({xs:l,columns:r,colors:realtimecharts[t.Name].colours,done:function(){setChartAsLoaded(t.Name)}}),null!=c&&null!=o&&(realtimecharts[t.Name].startdate=c,realtimecharts[t.Name].enddate=o),Object.keys(l).length>1?e.legend.show():e.legend.hide(),$.each(e.xs(),(function(a,r){a in t.XValues?n++:e.unload({ids:a})})),0==n?showChartNoData(realtimecharts[t.Name]):hideChartNoData(realtimecharts[t.Name]),hideChartSpinner(realtimecharts[t.Name]),setTimeout((function(){resizeRealTimeChart(realtimecharts[t.Name],!1)}),a?0:350)}},t.updateRealTimePieChart=function(t){if(t.Name in realtimecharts){var e=realtimecharts[t.Name].chart,a=realtimecharts[t.Name].suppressupdate,r=[];void 0!==t.Colours&&t.Colours&&$.each(t.Colours,(function(e,a){t.Colours[e]&&(realtimecharts[t.Name].colours[e]="#"+t.Colours[e])}));var n=!1;$.each(t.XValues,(function(e,a){$.each(a,(function(a,l){!n&&$.isNumeric(l)&&parseFloat(l)>0&&(n=!0),r.push([t.Labels[e][a],parseFloat(l)]),realtimecharts[t.Name].labels[t.Labels[e][a]]=t.Labels[e][a]}))})),n?(e.load({columns:r,colors:realtimecharts[t.Name].colours,done:function(){setChartAsLoaded(t.Name)}}),hideChartNoData(realtimecharts[t.Name])):showChartNoData(realtimecharts[t.Name]),hideChartSpinner(realtimecharts[t.Name]),setTimeout((function(){resizeRealTimeChart(realtimecharts[t.Name],!1)}),a?0:350)}},t.updateRealTimeScatterChart=function(t){if(t.Name in realtimecharts){var e=realtimecharts[t.Name].chart,a=realtimecharts[t.Name].suppressupdate,r=[],n=0;void 0!==t.Colours&&t.Colours&&$.each(t.Colours,(function(e,a){t.Colours[e]&&(realtimecharts[t.Name].colours[e]="#"+t.Colours[e])}));var l={},o=null,c=null,i="time"==e.internal.config.axis_x_type||"timeseries"==e.internal.config.axis_x_type;$.each(t.XValues,(function(e,a){var n=0,s=[],u=[];s.push(e+"_x"),u.push(e),$.each(a,(function(a,r){if(r.indexOf("-")>=0){var l=Date.parse(r);s.push(l),i&&(l=moment(l),(null==c||l<c)&&(c=l),(null==o||l>o)&&(o=l))}else s.push(parseFloat(r));u.push(t.YValues[e][n]),n++})),r.push(s),r.push(u),l[e]=e+"_x",realtimecharts[t.Name].labels[e]=t.Labels[e]})),e.load({xs:l,columns:r,colors:realtimecharts[t.Name].colours,done:function(){setChartAsLoaded(t.Name)}}),null!=c&&null!=o&&(realtimecharts[t.Name].startdate=c,realtimecharts[t.Name].enddate=o),Object.keys(l).length>1?e.legend.show():e.legend.hide(),$.each(e.xs(),(function(a,r){a in t.XValues?n++:e.unload({ids:a})})),0==n?showChartNoData(realtimecharts[t.Name]):hideChartNoData(realtimecharts[t.Name]),hideChartSpinner(realtimecharts[t.Name]),setTimeout((function(){resizeRealTimeChart(realtimecharts[t.Name],!1)}),a?0:350)}},t.updateRealTimeSummarytableChart=function(t){if(t.Name in realtimecharts){var e=realtimecharts[t.Name].suppressupdate,a=realtimecharts[t.Name],r=$("#"+a.uid);e?(r.html(response),hideSummarySpinner(realtimecharts[t.Name]),null!=t.RawHtml&&0!==tableTarget.length&&tableTarget.html(t.RawHtml),a.chart=$("#"+a.uid+" > div > .summary-table-group"),resizeRealTimeChart(a,!0),setTimeout((function(){setChartAsLoaded(a.uid)}),200)):$.ajax({url:"/RealTimeChart/FormatSummaryTable/",type:"POST",data:{tables:t.SummaryTable,fold:realtimecharts[t.Name].tabledefinition.fold,highlightFirstRow:realtimecharts[t.Name].tabledefinition.highlightfirstrow},cache:!1,crossDomain:!0,xhrFields:{withCredentials:!0},success:function(e){hideSummarySpinner(realtimecharts[t.Name]),r.html(e),a.chart=$("#"+a.uid+" > div > .summary-table-group"),resizeRealTimeChart(a,!0),setUpSummaryTableDrawer(a),setChartAsLoaded(a.uid)}})}}}));
//# sourceMappingURL=undefined.min.js.map
